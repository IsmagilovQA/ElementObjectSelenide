group 'SelenideTestProject'
version '0.3'

apply plugin: 'java'
apply plugin: 'ru.d10xa.allure'

buildscript {
    repositories {
        mavenCentral()
        jcenter()
    }
    dependencies {
        classpath "ru.d10xa:gradle-allure-plugin:+"
    }
}

allure {
    aspectjweaver = true
    junit = true
    allureResultsDir = "$buildDir/allure-results"
    allureReportDir = "$buildDir/allure-report"
}
repositories {
    mavenCentral()
    jcenter()
}

dependencies {
    compile 'org.aspectj:aspectjweaver:+'
    compile 'junit:junit:+'
    compile 'org.slf4j:slf4j-nop:+'
    compile 'com.codeborne:selenide:3.10'
    compile 'ru.yandex.qatools.allure:allure-junit-adaptor:+'
}

tasks.withType(Test) {
    testTask ->
        testTask.useJUnit()
        testTask.ignoreFailures = true
        testTask.systemProperties(
                'selenide.baseUrl':System.getProperty("siteUrl"),
                'webdriver.chrome.driver': "Drivers/chromedriver.exe",
                'selenide.browser': 'chrome',
                'selenide.start.maximized': 'true',
                'selenide.page-load-strategy':'normal',
                'selenide.savePageSource': 'false',
                'selenide.fileDownload': 'HTTPGET'
        )
}

task cleanBuild(type: Delete) {
    delete 'build'
}

compileJava.dependsOn cleanBuild

test.finalizedBy allureReport

task wrapper(type: Wrapper) {
    gradleVersion = '3.1'
    jarFile = './gradle-wrapper/gradle-wrapper.jar'
    scriptFile = './gradle'
}